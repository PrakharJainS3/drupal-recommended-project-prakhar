version: 1.0.0
events:
  build:
    steps:
      - SonarQube_scan:
          type: script
          script: # Moving to root location of pipeline
            - echo "Running scan from root"
            - cd /mnt/tmp/local.prod/source
            # Installing Sonar-scanner
            - echo "Downloading SonarScanner..."
            - curl -sSLo sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip
            - unzip sonar-scanner.zip
            - export PATH=$PATH:$(pwd)/sonar-scanner-5.0.1.3006-linux/bin
            # Running SonarScanner and submitting analysis to SonarQube...
            - echo "Running Analysis...."
            - |
              sonar-scanner \
              -Dsonar.projectKey=Altera \
              -Dsonar.sources="docroot/modules/custom,docroot/themes/custom" \
              -Dsonar.host.url=http://52.163.54.91:9000 \
              -Dsonar.token="$SONAR_TOKEN"
              
